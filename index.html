<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêù Spelling Bee Ëã±ÊñáÊãºÂ≠óÂ≠∏ÁøíÊ©ü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-yellow: #FFD93D;
            --primary-blue: #6BCB77;
            --sky-blue: #4D96FF;
            --soft-pink: #FF6B9D;
            --light-bg: #FFF9E6;
            --card-bg: #FFFFFF;
            --vowel-red: #FF4757;
            --consonant-blue: #2E86AB;
        }

        body {
            font-family: 'Comic Sans MS', 'Segoe UI', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #E8F4FD 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .app-container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-yellow) 0%, #FFA41B 100%);
            border-radius: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(255, 164, 27, 0.3);
        }

        .header h1 {
            font-size: 2rem;
            color: #5D4037;
            text-shadow: 2px 2px 0 #fff;
        }

        .header p {
            color: #6D4C41;
            margin-top: 5px;
            font-size: 1rem;
        }

        /* Controls Panel */
        .controls-panel {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            font-weight: bold;
            color: #5D4037;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 3px solid var(--sky-blue);
            border-radius: 10px;
            font-size: 1rem;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:focus {
            outline: none;
            border-color: var(--soft-pink);
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.3);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 10px;
            border: none;
            border-radius: 15px 15px 0 0;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #fff;
        }

        .tab-btn:nth-child(1) {
            background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%);
        }

        .tab-btn:nth-child(2) {
            background: linear-gradient(135deg, #A8EDEA 0%, #FED6E3 100%);
        }

        .tab-btn:nth-child(3) {
            background: linear-gradient(135deg, #D299C2 0%, #FEF9D7 100%);
        }

        .tab-btn.active {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .tab-btn:not(.active) {
            opacity: 0.7;
        }

        /* Main Content Area */
        .content-area {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            min-height: 400px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        /* Word Card - Mode A */
        .word-card {
            text-align: center;
            padding: 20px;
        }

        .word-display {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            letter-spacing: 8px;
            line-height: 1.3;
        }

        .word-display .vowel {
            color: var(--vowel-red);
        }

        .word-display .consonant {
            color: var(--consonant-blue);
        }

        .syllable-display {
            font-size: 2rem;
            color: #888;
            margin: 15px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 15px;
            display: none;
        }

        .syllable-display.show {
            display: block;
        }

        .syllable-display span {
            padding: 5px 15px;
            margin: 0 5px;
            background: var(--primary-yellow);
            border-radius: 10px;
            display: inline-block;
        }

        .chinese-meaning {
            font-size: 1.8rem;
            color: #666;
            margin: 15px 0;
        }

        .example-sentence {
            font-size: 1.2rem;
            color: #888;
            font-style: italic;
            padding: 15px;
            background: linear-gradient(135deg, #FFF9E6 0%, #E8F4FD 100%);
            border-radius: 15px;
            margin: 15px 0;
        }

        /* Buttons */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-speak {
            background: linear-gradient(135deg, var(--sky-blue) 0%, #5F9DF7 100%);
            color: white;
        }

        .btn-speak:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(79, 150, 255, 0.4);
        }

        .btn-toggle {
            background: linear-gradient(135deg, var(--primary-yellow) 0%, #FFA41B 100%);
            color: #5D4037;
        }

        .btn-nav {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #4ECDC4 100%);
            color: white;
            min-width: 120px;
        }

        .btn-nav:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Progress */
        .progress-info {
            text-align: center;
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 15px;
        }

        /* Mode B - Block Building */
        .block-area {
            text-align: center;
            padding: 20px;
        }

        .hint-area {
            margin-bottom: 20px;
        }

        .answer-slots {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
            min-height: 80px;
        }

        .answer-slot {
            width: 60px;
            height: 70px;
            border: 4px dashed #ccc;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--consonant-blue);
            background: #f9f9f9;
            transition: all 0.3s;
        }

        .answer-slot.filled {
            border: 4px solid var(--primary-blue);
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
        }

        .letter-blocks {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .letter-block {
            width: 60px;
            height: 70px;
            border: none;
            border-radius: 15px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, var(--sky-blue) 0%, #5F9DF7 100%);
            color: white;
            box-shadow: 0 4px 0 #3D7CC9;
        }

        .letter-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 #3D7CC9;
        }

        .letter-block:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #3D7CC9;
        }

        .letter-block.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-clear {
            background: linear-gradient(135deg, #FF6B6B 0%, #EE5A5A 100%);
            color: white;
        }

        /* Mode C - Dictation */
        .dictation-area {
            text-align: center;
            padding: 20px;
        }

        .input-container {
            margin: 30px 0;
        }

        .dictation-input {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            font-size: 2rem;
            text-align: center;
            border: 4px solid var(--sky-blue);
            border-radius: 15px;
            letter-spacing: 5px;
            text-transform: lowercase;
        }

        .dictation-input:focus {
            outline: none;
            border-color: var(--soft-pink);
        }

        .dictation-input.correct {
            border-color: var(--primary-blue);
            background: #E8F5E9;
        }

        .dictation-input.wrong {
            border-color: #FF6B6B;
            background: #FFEBEE;
        }

        /* Feedback */
        .feedback {
            font-size: 1.5rem;
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: bounceIn 0.5s;
        }

        .feedback.success {
            background: linear-gradient(135deg, #C8E6C9 0%, #A5D6A7 100%);
            color: #2E7D32;
        }

        .feedback.error {
            background: linear-gradient(135deg, #FFCDD2 0%, #EF9A9A 100%);
            color: #C62828;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Legend */
        .color-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            font-size: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .legend-dot.vowel {
            background: var(--vowel-red);
        }

        .legend-dot.consonant {
            background: var(--consonant-blue);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .word-display {
                font-size: 2.5rem;
                letter-spacing: 5px;
            }

            .syllable-display {
                font-size: 1.5rem;
            }

            .chinese-meaning {
                font-size: 1.4rem;
            }

            .tab-btn {
                padding: 12px 8px;
                font-size: 0.85rem;
            }

            .answer-slot, .letter-block {
                width: 50px;
                height: 60px;
                font-size: 1.8rem;
            }

            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .dictation-input {
                font-size: 1.5rem;
                padding: 15px;
            }

            .control-group {
                min-width: 100%;
            }
        }

        /* Score Display */
        .score-display {
            background: linear-gradient(135deg, #FFD93D 0%, #FFA41B 100%);
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            margin: 10px 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: #5D4037;
        }

        /* Confetti effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--primary-yellow);
            animation: confetti-fall 3s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>üêù Spelling Bee Ëã±ÊñáÊãºÂ≠óÂ≠∏ÁøíÊ©ü</h1>
            <p>Let's learn English together! ‰∏ÄËµ∑‰æÜÂ≠∏Ëã±ÊñáÂêßÔºÅ</p>
        </header>

        <div class="controls-panel">
            <div class="control-row">
                <div class="control-group">
                    <label>üìö ÈÅ∏ÊìáÈóúÂç° Level</label>
                    <select id="levelSelect">
                        <option value="all">üåü ÂÖ®ÈÉ®ÂñÆÂ≠ó</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>üîä ÈÅ∏ÊìáË™ûÈü≥ Voice</label>
                    <select id="voiceSelect">
                        <option value="">ËºâÂÖ•‰∏≠...</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-mode="learn">üìñ Â≠∏ÁøíÊ®°Âºè</button>
            <button class="tab-btn" data-mode="blocks">üß± Á©çÊú®ÊãºÂ≠ó</button>
            <button class="tab-btn" data-mode="dictation">‚úèÔ∏è ËÅΩÂØ´Á∑¥Áøí</button>
        </div>

        <div class="content-area">
            <!-- Mode A: Learning -->
            <div id="learnMode" class="mode-content">
                <div class="word-card">
                    <div class="progress-info">
                        ÂñÆÂ≠ó <span id="currentIndex">1</span> / <span id="totalWords">0</span>
                    </div>
                    <div class="score-display">‚≠ê ÂæóÂàÜ: <span id="score">0</span></div>

                    <div class="color-legend">
                        <div class="legend-item">
                            <div class="legend-dot vowel"></div>
                            <span>ÊØçÈü≥ Vowel</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot consonant"></div>
                            <span>Â≠êÈü≥ Consonant</span>
                        </div>
                    </div>

                    <div id="wordDisplay" class="word-display"></div>
                    <div id="syllableDisplay" class="syllable-display"></div>
                    <div id="chineseMeaning" class="chinese-meaning"></div>
                    <div id="exampleSentence" class="example-sentence"></div>

                    <div class="nav-buttons">
                        <button class="btn btn-speak" onclick="speakWord()">üîä ËÅΩÁôºÈü≥</button>
                        <button class="btn btn-toggle" onclick="toggleSyllables()">üìù È°ØÁ§∫Èü≥ÁØÄ</button>
                    </div>
                    <div class="nav-buttons">
                        <button class="btn btn-nav" id="prevBtn" onclick="prevWord()">‚¨ÖÔ∏è ‰∏ä‰∏ÄÂÄã</button>
                        <button class="btn btn-nav" id="nextBtn" onclick="nextWord()">‰∏ã‰∏ÄÂÄã ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <!-- Mode B: Block Building -->
            <div id="blocksMode" class="mode-content" style="display: none;">
                <div class="block-area">
                    <div class="progress-info">
                        ÂñÆÂ≠ó <span id="blockCurrentIndex">1</span> / <span id="blockTotalWords">0</span>
                    </div>
                    <div class="score-display">‚≠ê ÂæóÂàÜ: <span id="blockScore">0</span></div>

                    <div class="hint-area">
                        <div id="blockChineseMeaning" class="chinese-meaning"></div>
                        <button class="btn btn-speak" onclick="speakWord()">üîä ÂÜçËÅΩ‰∏ÄÊ¨°</button>
                    </div>

                    <div id="answerSlots" class="answer-slots"></div>
                    <div id="letterBlocks" class="letter-blocks"></div>

                    <div id="blockFeedback" class="feedback"></div>

                    <div class="nav-buttons">
                        <button class="btn btn-clear" onclick="clearBlocks()">üóëÔ∏è Ê∏ÖÈô§Èáç‰æÜ</button>
                    </div>
                    <div class="nav-buttons">
                        <button class="btn btn-nav" id="blockPrevBtn" onclick="prevWord()">‚¨ÖÔ∏è ‰∏ä‰∏ÄÂÄã</button>
                        <button class="btn btn-nav" id="blockNextBtn" onclick="nextWord()">‰∏ã‰∏ÄÂÄã ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <!-- Mode C: Dictation -->
            <div id="dictationMode" class="mode-content" style="display: none;">
                <div class="dictation-area">
                    <div class="progress-info">
                        ÂñÆÂ≠ó <span id="dictCurrentIndex">1</span> / <span id="dictTotalWords">0</span>
                    </div>
                    <div class="score-display">‚≠ê ÂæóÂàÜ: <span id="dictScore">0</span></div>

                    <div class="hint-area">
                        <div id="dictChineseMeaning" class="chinese-meaning"></div>
                        <button class="btn btn-speak" onclick="speakWord()">üîä ÂÜçËÅΩ‰∏ÄÊ¨°</button>
                    </div>

                    <div class="input-container">
                        <input type="text" id="dictationInput" class="dictation-input"
                               placeholder="Ëº∏ÂÖ•ÂñÆÂ≠ó..." autocomplete="off" autocapitalize="off">
                    </div>

                    <div id="dictFeedback" class="feedback"></div>

                    <div class="nav-buttons">
                        <button class="btn btn-toggle" onclick="checkDictation()">‚úÖ Ê™¢Êü•Á≠îÊ°à</button>
                        <button class="btn btn-clear" onclick="showHint()">üí° ÊèêÁ§∫</button>
                    </div>
                    <div class="nav-buttons">
                        <button class="btn btn-nav" id="dictPrevBtn" onclick="prevWord()">‚¨ÖÔ∏è ‰∏ä‰∏ÄÂÄã</button>
                        <button class="btn btn-nav" id="dictNextBtn" onclick="nextWord()">‰∏ã‰∏ÄÂÄã ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂñÆÂ≠óË≥áÊñôÂ∫´
        const wordsData = [
            { word: "apple", syllables: ["ap", "ple"], chinese: "ËòãÊûú", example: "I eat an apple every day." },
            { word: "banana", syllables: ["ba", "na", "na"], chinese: "È¶ôËïâ", example: "The monkey loves banana." },
            { word: "cat", syllables: ["cat"], chinese: "Ë≤ì", example: "The cat is sleeping." },
            { word: "dog", syllables: ["dog"], chinese: "Áãó", example: "My dog is very friendly." },
            { word: "elephant", syllables: ["el", "e", "phant"], chinese: "Â§ßË±°", example: "The elephant has a long trunk." },
            { word: "fish", syllables: ["fish"], chinese: "È≠ö", example: "Fish live in water." },
            { word: "giraffe", syllables: ["gi", "raffe"], chinese: "Èï∑È†∏Èπø", example: "The giraffe has a long neck." },
            { word: "happy", syllables: ["hap", "py"], chinese: "Âø´Ê®ÇÁöÑ", example: "I am very happy today." },
            { word: "ice cream", syllables: ["ice", "cream"], chinese: "ÂÜ∞Ê∑áÊ∑ã", example: "I love ice cream in summer." },
            { word: "juice", syllables: ["juice"], chinese: "ÊûúÊ±Å", example: "Orange juice is delicious." },
            { word: "kite", syllables: ["kite"], chinese: "È¢®ÁÆè", example: "Let's fly a kite in the park." },
            { word: "lion", syllables: ["li", "on"], chinese: "ÁçÖÂ≠ê", example: "The lion is the king of animals." },
            { word: "monkey", syllables: ["mon", "key"], chinese: "Áå¥Â≠ê", example: "The monkey climbs the tree." },
            { word: "nest", syllables: ["nest"], chinese: "È≥•Â∑¢", example: "Birds build a nest in the tree." },
            { word: "orange", syllables: ["or", "ange"], chinese: "Ê©òÂ≠ê/Ê©ôËâ≤", example: "I like to eat orange." },
            { word: "pizza", syllables: ["piz", "za"], chinese: "Êä´Ëñ©", example: "Pizza is my favorite food." },
            { word: "queen", syllables: ["queen"], chinese: "ÁöáÂêé", example: "The queen lives in a castle." },
            { word: "rabbit", syllables: ["rab", "bit"], chinese: "ÂÖîÂ≠ê", example: "The rabbit has long ears." },
            { word: "sun", syllables: ["sun"], chinese: "Â§™ÈôΩ", example: "The sun rises in the east." },
            { word: "tiger", syllables: ["ti", "ger"], chinese: "ËÄÅËôé", example: "The tiger runs very fast." },
            { word: "umbrella", syllables: ["um", "brel", "la"], chinese: "Èõ®ÂÇò", example: "Take an umbrella when it rains." },
            { word: "violet", syllables: ["vi", "o", "let"], chinese: "Á¥´ÁæÖËò≠/Á¥´Ëâ≤", example: "Violet is a beautiful color." },
            { word: "water", syllables: ["wa", "ter"], chinese: "Ê∞¥", example: "We need water to live." },
            { word: "xylophone", syllables: ["xy", "lo", "phone"], chinese: "Êú®Áê¥", example: "She plays the xylophone." },
            { word: "yellow", syllables: ["yel", "low"], chinese: "ÈªÉËâ≤", example: "The sun is yellow." },
            { word: "zebra", syllables: ["ze", "bra"], chinese: "ÊñëÈ¶¨", example: "A zebra has black and white stripes." },
            { word: "bird", syllables: ["bird"], chinese: "È≥•", example: "The bird can fly high." },
            { word: "butterfly", syllables: ["but", "ter", "fly"], chinese: "Ëù¥Ëù∂", example: "The butterfly is beautiful." },
            { word: "cloud", syllables: ["cloud"], chinese: "Èõ≤", example: "Look at the white cloud." },
            { word: "flower", syllables: ["flow", "er"], chinese: "Ëä±", example: "The flower smells nice." },
            { word: "garden", syllables: ["gar", "den"], chinese: "Ëä±Âúí", example: "We play in the garden." },
            { word: "house", syllables: ["house"], chinese: "ÊàøÂ≠ê", example: "I live in a big house." },
            { word: "island", syllables: ["is", "land"], chinese: "Â≥∂Â∂º", example: "The island is in the ocean." },
            { word: "jelly", syllables: ["jel", "ly"], chinese: "ÊûúÂáç", example: "Kids love to eat jelly." },
            { word: "kitchen", syllables: ["kitch", "en"], chinese: "ÂªöÊàø", example: "Mom cooks in the kitchen." },
            { word: "lemon", syllables: ["lem", "on"], chinese: "Ê™∏Ê™¨", example: "Lemon is very sour." },
            { word: "mountain", syllables: ["moun", "tain"], chinese: "Â±±", example: "The mountain is very tall." },
            { word: "notebook", syllables: ["note", "book"], chinese: "Á≠ÜË®òÊú¨", example: "I write in my notebook." },
            { word: "ocean", syllables: ["o", "cean"], chinese: "Êµ∑Ê¥ã", example: "The ocean is very deep." },
            { word: "pencil", syllables: ["pen", "cil"], chinese: "ÈâõÁ≠Ü", example: "I draw with a pencil." },
            { word: "rainbow", syllables: ["rain", "bow"], chinese: "ÂΩ©Ëôπ", example: "The rainbow has seven colors." },
            { word: "school", syllables: ["school"], chinese: "Â≠∏Ê†°", example: "I go to school every day." },
            { word: "teacher", syllables: ["teach", "er"], chinese: "ËÄÅÂ∏´", example: "My teacher is very kind." },
            { word: "unicorn", syllables: ["u", "ni", "corn"], chinese: "Áç®ËßíÁç∏", example: "The unicorn is magical." },
            { word: "vegetable", syllables: ["veg", "e", "ta", "ble"], chinese: "Ëî¨Ëèú", example: "Eat more vegetables." },
            { word: "window", syllables: ["win", "dow"], chinese: "Á™óÊà∂", example: "Open the window please." },
            { word: "box", syllables: ["box"], chinese: "ÁõíÂ≠ê", example: "The toy is in the box." },
            { word: "yard", syllables: ["yard"], chinese: "Èô¢Â≠ê", example: "I play in the yard." },
            { word: "zoo", syllables: ["zoo"], chinese: "ÂãïÁâ©Âúí", example: "We visit the zoo on Sunday." },
            { word: "friend", syllables: ["friend"], chinese: "ÊúãÂèã", example: "You are my best friend." }
        ];

        // ÂÖ®ÂüüËÆäÊï∏
        let currentWords = [...wordsData];
        let currentIndex = 0;
        let currentMode = 'learn';
        let selectedVoice = null;
        let syllablesVisible = false;
        let score = 0;
        let selectedLetters = [];
        let hintCount = 0;

        const vowels = ['a', 'e', 'i', 'o', 'u'];

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            initVoices();
            initLevels();
            initTabs();
            initDictationInput();
            updateDisplay();
        });

        // ÂàùÂßãÂåñË™ûÈü≥
        function initVoices() {
            const voiceSelect = document.getElementById('voiceSelect');

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                voiceSelect.innerHTML = '';

                let defaultIndex = 0;
                voices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    voiceSelect.appendChild(option);

                    // ÂÑ™ÂÖàÈÅ∏ÊìáËã±ÊñáË™ûÈü≥
                    if (voice.lang.includes('en') &&
                        (voice.name.includes('Google') || voice.name.includes('English') ||
                         voice.name.includes('US') || voice.name.includes('UK'))) {
                        defaultIndex = index;
                    }
                });

                voiceSelect.value = defaultIndex;
                selectedVoice = voices[defaultIndex];
            }

            loadVoices();
            speechSynthesis.onvoiceschanged = loadVoices;

            voiceSelect.addEventListener('change', (e) => {
                const voices = speechSynthesis.getVoices();
                selectedVoice = voices[e.target.value];
            });
        }

        // ÂàùÂßãÂåñÈóúÂç°ÈÅ∏ÂñÆ
        function initLevels() {
            const levelSelect = document.getElementById('levelSelect');
            const totalLevels = Math.ceil(wordsData.length / 10);

            for (let i = 1; i <= totalLevels; i++) {
                const option = document.createElement('option');
                option.value = i;
                const startWord = (i - 1) * 10 + 1;
                const endWord = Math.min(i * 10, wordsData.length);
                option.textContent = `Level ${i} (Á¨¨ ${startWord}-${endWord} ÂÄã)`;
                levelSelect.appendChild(option);
            }

            levelSelect.addEventListener('change', (e) => {
                const value = e.target.value;
                if (value === 'all') {
                    currentWords = [...wordsData];
                } else {
                    const level = parseInt(value);
                    const start = (level - 1) * 10;
                    const end = level * 10;
                    currentWords = wordsData.slice(start, end);
                }
                currentIndex = 0;
                score = 0;
                updateDisplay();
            });
        }

        // ÂàùÂßãÂåñ Tabs
        function initTabs() {
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    currentMode = tab.dataset.mode;
                    document.getElementById('learnMode').style.display = currentMode === 'learn' ? 'block' : 'none';
                    document.getElementById('blocksMode').style.display = currentMode === 'blocks' ? 'block' : 'none';
                    document.getElementById('dictationMode').style.display = currentMode === 'dictation' ? 'block' : 'none';

                    updateDisplay();
                    if (currentMode !== 'learn') {
                        speakWord();
                    }
                });
            });
        }

        // ÂàùÂßãÂåñËÅΩÂØ´Ëº∏ÂÖ•
        function initDictationInput() {
            const input = document.getElementById('dictationInput');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkDictation();
                }
            });
        }

        // Êõ¥Êñ∞È°ØÁ§∫
        function updateDisplay() {
            if (currentWords.length === 0) return;

            const wordData = currentWords[currentIndex];
            const word = wordData.word.replace(' ', ''); // ËôïÁêÜÊúâÁ©∫Ê†ºÁöÑÂñÆÂ≠óÂ¶Ç ice cream

            // Êõ¥Êñ∞ÈÄ≤Â∫¶
            document.getElementById('currentIndex').textContent = currentIndex + 1;
            document.getElementById('totalWords').textContent = currentWords.length;
            document.getElementById('blockCurrentIndex').textContent = currentIndex + 1;
            document.getElementById('blockTotalWords').textContent = currentWords.length;
            document.getElementById('dictCurrentIndex').textContent = currentIndex + 1;
            document.getElementById('dictTotalWords').textContent = currentWords.length;

            // Êõ¥Êñ∞ÂàÜÊï∏
            document.getElementById('score').textContent = score;
            document.getElementById('blockScore').textContent = score;
            document.getElementById('dictScore').textContent = score;

            // Ê®°Âºè A: Â≠∏Áøí
            const wordDisplay = document.getElementById('wordDisplay');
            wordDisplay.innerHTML = wordData.word.split('').map(char => {
                if (char === ' ') return ' ';
                const isVowel = vowels.includes(char.toLowerCase());
                return `<span class="${isVowel ? 'vowel' : 'consonant'}">${char}</span>`;
            }).join('');

            const syllableDisplay = document.getElementById('syllableDisplay');
            syllableDisplay.innerHTML = wordData.syllables.map(s => `<span>${s}</span>`).join('');
            syllableDisplay.classList.toggle('show', syllablesVisible);

            document.getElementById('chineseMeaning').textContent = `üìñ ${wordData.chinese}`;
            document.getElementById('exampleSentence').textContent = `üí¨ ${wordData.example}`;

            // Ê®°Âºè B: Á©çÊú®
            document.getElementById('blockChineseMeaning').textContent = `üìñ ${wordData.chinese}`;
            setupBlocks(word);

            // Ê®°Âºè C: ËÅΩÂØ´
            document.getElementById('dictChineseMeaning').textContent = `üìñ ${wordData.chinese}`;
            document.getElementById('dictationInput').value = '';
            document.getElementById('dictationInput').className = 'dictation-input';
            document.getElementById('dictFeedback').classList.remove('show');
            hintCount = 0;

            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === currentWords.length - 1;
            document.getElementById('blockPrevBtn').disabled = currentIndex === 0;
            document.getElementById('blockNextBtn').disabled = currentIndex === currentWords.length - 1;
            document.getElementById('dictPrevBtn').disabled = currentIndex === 0;
            document.getElementById('dictNextBtn').disabled = currentIndex === currentWords.length - 1;

            // Ê∏ÖÈô§ÂõûÈ•ã
            document.getElementById('blockFeedback').classList.remove('show');
        }

        // Ë®≠ÁΩÆÁ©çÊú®
        function setupBlocks(word) {
            const cleanWord = word.replace(/\s/g, '').toLowerCase();
            selectedLetters = [];

            // ÂâµÂª∫Á≠îÊ°àÊßΩ
            const slotsContainer = document.getElementById('answerSlots');
            slotsContainer.innerHTML = '';
            for (let i = 0; i < cleanWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'answer-slot';
                slot.dataset.index = i;
                slotsContainer.appendChild(slot);
            }

            // ÂâµÂª∫Êâì‰∫ÇÁöÑÂ≠óÊØçÁ©çÊú®
            const blocksContainer = document.getElementById('letterBlocks');
            blocksContainer.innerHTML = '';
            const shuffledLetters = cleanWord.split('').sort(() => Math.random() - 0.5);

            shuffledLetters.forEach((letter, i) => {
                const block = document.createElement('button');
                block.className = 'letter-block';
                block.textContent = letter.toUpperCase();
                block.dataset.index = i;
                block.dataset.letter = letter;
                block.addEventListener('click', () => selectLetter(block, letter));
                blocksContainer.appendChild(block);
            });
        }

        // ÈÅ∏ÊìáÂ≠óÊØç
        function selectLetter(block, letter) {
            if (block.classList.contains('used')) return;

            const wordData = currentWords[currentIndex];
            const cleanWord = wordData.word.replace(/\s/g, '').toLowerCase();

            block.classList.add('used');
            selectedLetters.push({ letter, block });

            // Êõ¥Êñ∞Á≠îÊ°àÊßΩ
            const slots = document.querySelectorAll('.answer-slot');
            const currentSlot = slots[selectedLetters.length - 1];
            currentSlot.textContent = letter.toUpperCase();
            currentSlot.classList.add('filled');

            // Ê™¢Êü•ÊòØÂê¶ÂÆåÊàê
            if (selectedLetters.length === cleanWord.length) {
                const answer = selectedLetters.map(s => s.letter).join('');
                const feedback = document.getElementById('blockFeedback');

                if (answer === cleanWord) {
                    feedback.textContent = 'üéâ Â§™Ê£í‰∫ÜÔºÅÁ≠îÂ∞ç‰∫ÜÔºÅGreat job!';
                    feedback.className = 'feedback success show';
                    score += 10;
                    document.getElementById('blockScore').textContent = score;
                    createConfetti();

                    // Ëá™ÂãïÂà∞‰∏ã‰∏ÄÈ°å
                    setTimeout(() => {
                        if (currentIndex < currentWords.length - 1) {
                            nextWord();
                        }
                    }, 1500);
                } else {
                    feedback.textContent = 'üòÖ ÂÜçË©¶‰∏ÄÊ¨°ÔºÅTry again!';
                    feedback.className = 'feedback error show';
                    setTimeout(clearBlocks, 1000);
                }
            }
        }

        // Ê∏ÖÈô§Á©çÊú®
        function clearBlocks() {
            selectedLetters = [];
            const slots = document.querySelectorAll('.answer-slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.classList.remove('filled');
            });

            const blocks = document.querySelectorAll('.letter-block');
            blocks.forEach(block => {
                block.classList.remove('used');
            });

            document.getElementById('blockFeedback').classList.remove('show');
        }

        // Ê™¢Êü•ËÅΩÂØ´
        function checkDictation() {
            const input = document.getElementById('dictationInput');
            const wordData = currentWords[currentIndex];
            const cleanWord = wordData.word.replace(/\s/g, '').toLowerCase();
            const answer = input.value.trim().toLowerCase();

            const feedback = document.getElementById('dictFeedback');

            if (answer === cleanWord) {
                input.className = 'dictation-input correct';
                feedback.textContent = 'üéâ Â§™Ê£í‰∫ÜÔºÅÁ≠îÂ∞ç‰∫ÜÔºÅGreat job!';
                feedback.className = 'feedback success show';
                score += 10 - hintCount * 2;
                document.getElementById('dictScore').textContent = score;
                createConfetti();

                setTimeout(() => {
                    if (currentIndex < currentWords.length - 1) {
                        nextWord();
                    }
                }, 1500);
            } else {
                input.className = 'dictation-input wrong';
                feedback.textContent = `üòÖ ÂÜçË©¶‰∏ÄÊ¨°ÔºÅÊ≠£Á¢∫Á≠îÊ°àÊúâ ${cleanWord.length} ÂÄãÂ≠óÊØç`;
                feedback.className = 'feedback error show';
            }
        }

        // È°ØÁ§∫ÊèêÁ§∫
        function showHint() {
            const wordData = currentWords[currentIndex];
            const cleanWord = wordData.word.replace(/\s/g, '').toLowerCase();
            const input = document.getElementById('dictationInput');

            hintCount++;
            if (hintCount <= cleanWord.length) {
                input.value = cleanWord.slice(0, hintCount);
                input.focus();
            }
        }

        // Êí≠ÊîæÁôºÈü≥
        function speakWord() {
            if (!currentWords.length) return;

            speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(currentWords[currentIndex].word);

            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }

            utterance.rate = 0.8;
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }

        // ÂàáÊèõÈü≥ÁØÄÈ°ØÁ§∫
        function toggleSyllables() {
            syllablesVisible = !syllablesVisible;
            document.getElementById('syllableDisplay').classList.toggle('show', syllablesVisible);
        }

        // ‰∏ä‰∏ÄÂÄãÂñÆÂ≠ó
        function prevWord() {
            if (currentIndex > 0) {
                currentIndex--;
                syllablesVisible = false;
                updateDisplay();
                if (currentMode !== 'learn') {
                    speakWord();
                }
            }
        }

        // ‰∏ã‰∏ÄÂÄãÂñÆÂ≠ó
        function nextWord() {
            if (currentIndex < currentWords.length - 1) {
                currentIndex++;
                syllablesVisible = false;
                updateDisplay();
                if (currentMode !== 'learn') {
                    speakWord();
                }
            }
        }

        // ÂâµÂª∫ÂΩ©Â∏∂ÊïàÊûú
        function createConfetti() {
            const colors = ['#FFD93D', '#FF6B9D', '#6BCB77', '#4D96FF', '#FF9A9E'];

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 3000);
            }
        }
    </script>
</body>
</html>
